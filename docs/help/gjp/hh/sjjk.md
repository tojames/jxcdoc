# 数据接口<Badge text="辉煌系列" />

多种数据接口，极大地方便软件数据的兼容。

门店数据接口，用于提供门店版独立账套运行时的数据交换;

标准财务版接口，用于导出数据，供用友软件与管家婆标准之类财务软件使用的接口；

盘点机接口,用于接收盘点机（数据采集器）进行库存盘点获得的数据；

单机版和网络版提供所有接口，试用版不提供任何数据接口,门店版只有门店接口；
## 盘点机接口

盘点工作是一项比较烦琐的工作，为了减轻工作难度，我们常借助盘点机进行业务处理。辉煌版提供盘点机接口，方便大家快速处理盘点业务。

要使用盘点机，则需要先将盘点机按照我们约定的格式进行编程处理，使之导出的数据格式符合导入的要求。

要求盘点机生成的文件格式如下：

仓库编号~商品条码~盘点数量

操作：系统维护-盘点机接口-接收盘点机盘点数据

如果仓库使用分量盘点，并且没有截止日期，则第一次导入数据时的日期为截止日期；

如果仓库使用分量盘点，并且已经有截止日期，并且截止日期与当前想导入数据的日期相差很小，则可以选择追加或覆盖两种导入方式，并且，导入到当前操作员自己的分量盘点表中。如果日期相差很大，则进行提醒，是否应该清空数据，使用新的分量盘点。

点“导入数据”，选择盘点机根据获得的基本信息进行盘点生成的数据文件。

追加：即往自动盘盈盘亏表中追加数据，不清除原有数据。

覆盖：即清除原有数据，以新导入数据取代。

特别说明：

如果你一次无法盘点完成，而是分成多次盘点，并且同一商品也不是一次盘点完成的，你需要进行多次盘点数据的接收，对于这种情况，你怎么办呢？

你需要在自动盘盈盘亏中选择分量盘点，然后使用盘点机接口进行数据的追加或覆盖。

将几次盘点数据都导入完成后，进入自动盘盈盘亏表，分量盘点结束，从而转总量盘点就行。

注意:盘点机导出的数据文件中,相同条码商品必须进行合并,不允许存在相同条码信息。

强调:盘点机功能只支持移动加权平均成本算法的商品，其它算法商品无法使用盘点机.
## 门店数据接口

辉煌门店版可以管理不独立核算的商业零售门市或分店，并能解决远程销售点和总公司之间的数据交换。以《管家婆》辉煌单机或网络版为后台，可根据门店和总公司之间的距离决定使用软盘或网络进行数据交换。

门店版不能建立基本信息也不能对期初数据进行处理，因此企业使用门店版时，需要将总店的基本信息和期初数据等信息发送给门店；而总店为了及时了解门店销售信息，需要门店实时或者定期上传数据；同样总店需要将新的商品信息和库存信息传送给门店。为了让企业对这些业务进行方便快捷的管理，系统提供了门店数据接口对门店与总店之间的数据传输进行处理。

门店业务流程：总部导出基本信息，门店接收基本信息，门店进行日常业务，门店业务数据结存，总部接收门店业务数据。

一、发送基本信息给门店

门店在后台是作为一个仓库管理的，基本信息和库存数据来自于后台。因此总店需要将使用的单机版或网络版中的基本信息和库存数据发送给门店。

操作：“系统维护－门店数据传输－发送基本信息到门店”。首先进行门店登记，然后导出门店需要的基本信息。

1、门店登记

所登记的门店，都对应该门店需要控制的仓库信息，这些信息在门店进行有些业务时需要受仓库控制。

2、基本信息导出

鼠标指定要导出基本信息的门店，然后点击导出，从而弹出如下窗口。默认情况下，导出的基本信息保存于服务器目录下“\DoorData\BaseInfo\门店编号”下，如果要保存于本地，则在“保存本地”前打勾，然后指定目录。导出的基本信息文件名后缀bas,名称格式为“baseinfo_＋门店编号.bas”。指定的门店是什么，门店编号就是什么。

二、门店接收基本信息

总部导出门店所需要基本信息后，通过U盘或邮件或其它方式拷贝到门店计算上，然后通过此接口，将基本信息导入账套。

首先，创建一个新账套，然后进入“系统维护－门店数据传输－接收基本信息”，找到存放基本信息文件的目录，选择要导入的信息内容，然后导入就行。

导入信息后，门店对应仓库信息就显示在用户配置-系统配置里了。

三、门店业务数据结存

门店进行日常业务后，需要将业务单据定期传递给总部，方便总部进行业务汇总分析。这就需要我们进行门店业务结存。

操作：进入“系统维护－门店数据传输－业务数据结存”，选择时间段，选择导出过账单据还是草稿单据，选择保存位置，然后导出就行。

默认情况下，业务结存数据保存于安装目录“\DoorData\BillPake”下，文件名格式“bill_＋门店编号_年月日.WRK”，后缀WRK。

四、接收门店业务数据

门店上传来的业务数据，通过该接口导入总账。

操作：进入“系统维护-门店数据接口-接收门店业务数据”，然后打开要导入的门店业务数据文件，接收就行。

注意：门店系统必须先开账才能接收数据。

注意：总部基本信息有变化，或者价格有变化，都应该向门店导出基本信息。

注意：门店业务数据导入后形成草稿，需要从业务草稿中再次过账才行。

注意：单机版或网络版当门店版使用时，不允许录入基本信息，其基本信息必须由总部提供。


## 财务数据接口

《管家婆》辉煌系列不能进行标准化财务管理，如企业需要进行标准财务管理时，可以将《管家婆》辉煌系列的物流单据科目信息和财务类单据信息，导出到“管家婆财务版”中使用。

在将《管家婆》辉煌版的数据导入到财务版中进行处理前，需要将《管家婆》辉煌版中的科目与财务版的科目进行一一对应，然后才能导出数据。

具体操作步骤如下：

1、进入“系统维护－财务数据接口”。选中会计科目，双击或点设置按钮，输入与使用的财务软件中对应会计科目的编号。

2、进入“系统维护－财务数据接口－导出数据”，选择要导出数据的日期段，然后将相关财务数据导出供其它软件使用。


## 总部数据传输设置

◆数据传输设置：数据传输设置是搭建总部与门店之间数据流通的桥梁，包含总部设置和门店设置两部分内容。门店设置部分请见【门店数据自动传输】

●总部设置

操作：辉煌产品安装以后在电脑的右下角任务栏中会有“辉煌传输服务器”的图标：，启动后主界面如下。

如没有启动则在管家婆服务器，右键菜单中点击“自动传输服务器”启动。

设置：

●传输设置：

操作一：传输服务器主界面—设置—传输设置，打开总部传输服务器设置界面，如下图：

操作二：右击传输服务器图标，选择“传输设置”

设置说明：

服务器：总部数据库服务器地址

用户名/密码：登录SqlServer的用户名及密码

数据库：总部帐套数据库名称

验证码：总部设置，门店匹配。即只有当门店此处设置验证码与总部一致时，才可以进行数据上下传。

●传输配置：提供两个选项，选择“确定”后生效

操作一：传输服务器主界面—设置—传输配置，调出配置界面如下图：

操作二：右击传输服务器图标，选择“传输配置”

下传总部物价管理和仓库物价管理：选上时，下传数据时总部物价及总部设置的仓库物价将覆盖门店物价。不选时，则门店自行设置物价。

上传单据自动过账：不选时，门店上传到总部的单据将为草稿状态，需要总部手动操作是否过账。

●传输状态：可查看门店历史上传、下载信息及当前传输状态。并支持按门店过滤。

强制清除门店传输状态：会终止门店传输处理，并清除门店本次上传数据。清除状态时清除的数据可重新上传。

●传输日志：可查看各门店的历史传输时间及日志。

●数据传输规则

●总部向门店传输：基本信息、物价及仓库物价、库存余量、由总部发起的配送单（未验收），以及由门店发起的配送退货单总部的验收状态。其中，物价及仓库物价是否下传受总部“传输配置”中控制。

●门店向总部传输：门店所有业务单据包括要货申请单，以及回传有总部发起的配送单门店的验收状态。

●会员信息传输及使用规则：

A非储值类会员卡，基本信息均由总部建立，下传到门店使用。同时下传会员累计消费及累计积分等状况。

B门店上传会员消费明细及积分明细，上传后更新总部会员积分情况。

C储值类会员卡，由门店自行发卡，并且不在其他门店使用。但信息及储值、消费、积分等明细上传到总部，总部可查询。

D老版本升级时，会将各门店会员信息全部上传至总部服务器，并统一下传至各门店。


## 门店数据自动传输

从管家婆辉煌Ⅱ++10.1版本开始，门店数据传输支持自动传输和手动传输两种方式，同时完全兼容原数据传输方式。数据自动传输设置包含总部设置和门店设置两部分内容。总部设置部分请见【总部数据传输设置】

操作：系统维护—门店数据传输—门店数据自动传输

相关设置：

◆远程服务器主机：总部帐套对应的服务器IP地址。

◆使用IP精灵：使用时选择，且选择后IP精灵密码有效。

◆定时设置：为自动传输数据提供定时设置，如下图

●启动自动传输：选择后定时设置方可生效。如不选，需要在传输工具中手工点击“接收数据”与“上传数据”进行数据传输。

●接收数据定时设置：从辉煌10.1开始，提供三种方式的定时自动传输数据：每天一次，每天两次，即每隔多长时间自动传输。

◆连接设置：

●服务器设置：对应门店帐套所在服务器

●用户名/密码：对应门店帐套所在服务器登陆SQLServer的用户名和密码

●数据库：对应门店帐套的数据库名

●验证码：必须与总部传输设置中所设置的验证码一致方可进行数据传输！一般由总部设置，再将验证码告知门店，有门店与之相匹配从而达到验证目的。

注意：门店传输服务设置中的连接设置与总部设置界面一致，但总部设置时对应总部帐套所在服务器及数据库，门店设置时对应门店帐套所在服务器及数据库。

◆传输日志：查看门店传输的历史情况
